<div class="live-view-container">
  <!-- Page Header -->
  <div class="page-header">
    <!-- LEFT: KNX Monitoring Controls -->
    <div class="page-header-left">
      <!-- KNX Connection -->
      @if (!isConnected) {
        <button mat-raised-button color="primary" (click)="connectToKnx()" [disabled]="isConnecting">
          <mat-icon>power_settings_new</mat-icon>
          {{ isConnecting ? 'Connecting...' : 'Connect KNX' }}
        </button>
      } @else {
        <button mat-raised-button color="warn" (click)="disconnectFromKnx()">
          <mat-icon>power_off</mat-icon>
          Disconnect
        </button>
      }

      <div class="divider"></div>

      <!-- Pause/Resume with Auto-scroll -->
      <button mat-raised-button (click)="togglePause()" [color]="isPaused ? 'accent' : ''">
        <mat-icon>{{ isPaused ? 'play_arrow' : 'pause' }}</mat-icon>
        {{ isPaused ? 'Resume' : 'Pause' }}
      </button>

      <mat-checkbox [(ngModel)]="autoScroll" class="auto-scroll-toggle" color="primary">
        Auto-scroll
      </mat-checkbox>
    </div>

    <!-- RIGHT: Data Management & Export -->
    <div class="page-header-right">
      <!-- Clear Data -->
      <button mat-raised-button (click)="clearTelegrams()">
        <mat-icon>clear_all</mat-icon>
        Clear
      </button>

      <div class="divider"></div>

      <!-- Export -->
      <button mat-raised-button (click)="exportToCsv()" [disabled]="telegrams.length === 0">
        <mat-icon>download</mat-icon>
        Export
      </button>

      <div class="divider"></div>

      <!-- Telegram Count -->
      <div class="telegram-counter">
        <mat-icon>list_alt</mat-icon>
        <span class="counter-value">{{ telegrams.length }}</span>
      </div>
    </div>
  </div>

  <!-- AG-Grid Table -->
  <div class="grid-container">
    <ag-grid-angular
      class="ag-theme-material"
      [rowData]="telegrams"
      [columnDefs]="columnDefs"
      [defaultColDef]="defaultColDef"
      [gridOptions]="gridOptions"
      [class.grid-empty]="telegrams.length === 0"
    >
    </ag-grid-angular>

    @if (telegrams.length === 0) {
      <div class="no-telegrams-overlay">
        <mat-icon>inbox</mat-icon>
        <h3>Get Started with KNX Monitoring</h3>

        @if (!isConnected) {
          <div class="setup-checklist">
            <p class="checklist-intro">Follow these steps to start monitoring:</p>

            <div class="checklist-item" [class.completed]="hasKnxConfig">
              <mat-icon class="checklist-icon">{{ hasKnxConfig ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
              <div class="checklist-content">
                <span class="checklist-title">Configure KNX Gateway</span>
                <span class="checklist-hint">Go to Settings → Add your KNX IP interface</span>
              </div>
              <button
                mat-icon-button
                class="checklist-action"
                (click)="navigateToSettings()"
                matTooltip="Go to Settings"
                matTooltipPosition="left"
              >
                <mat-icon>arrow_forward</mat-icon>
              </button>
            </div>

            <div class="checklist-item" [class.completed]="hasProject">
              <mat-icon class="checklist-icon">{{ hasProject ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
              <div class="checklist-content">
                <span class="checklist-title">Import a .knxproj file</span>
                <span class="checklist-hint">Go to Projects → Import your ETS project</span>
              </div>
              <button
                mat-icon-button
                class="checklist-action"
                (click)="navigateToProjects()"
                matTooltip="Go to Projects"
                matTooltipPosition="left"
              >
                <mat-icon>arrow_forward</mat-icon>
              </button>
            </div>

            <div class="checklist-item" [class.completed]="false">
              <mat-icon class="checklist-icon">radio_button_unchecked</mat-icon>
              <div class="checklist-content">
                <span class="checklist-title">Connect to KNX</span>
                <span class="checklist-hint">Click "Connect KNX" button above</span>
              </div>
              <button
                mat-icon-button
                class="checklist-action checklist-action-disabled"
                disabled
                matTooltip="Use button in header"
                matTooltipPosition="left"
              >
                <mat-icon>arrow_upward</mat-icon>
              </button>
            </div>
          </div>
        } @else {
          <p class="hint connected">
            <mat-icon>check_circle</mat-icon>
            Connected and waiting for KNX telegrams...
          </p>
        }
      </div>
    }
  </div>

  <!-- Footer with status -->
  <div class="footer">
    <div class="footer-left">
      <span class="status-indicator" [class.connected]="isConnected">
        <mat-icon>{{ isConnected ? 'check_circle' : 'cancel' }}</mat-icon>
        {{ isConnected ? 'Connected' : 'Disconnected' }}
      </span>
      @if (isPaused) {
        <span class="paused-indicator">
          <mat-icon>pause_circle</mat-icon>
          Paused
        </span>
      }
    </div>

    <div class="footer-right">
      <span class="info-text">
        <strong>Shortcut:</strong>
        Space = Pause/Resume
      </span>
    </div>
  </div>
</div>
